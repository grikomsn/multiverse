---
title: Prevent FOUC on Next.js + Chakra UI
description: TL;DR, use @emotion/cache and @emotion/server to prevent initial unstyled content
date: 2021-08-13
---

If you're using [Chakra UI](https://chakra-ui.com/) with [Next.js](https://nextjs.org/), chances are that you'll encounter an initial white flash or some parts still unstyled before the full content loads. This is known as [FOUC (flash of unstyled content)](https://en.wikipedia.org/wiki/Flash_of_unstyled_content). Here's an example of this website with the FOUC issue: https://v7-git-test-without-emotion-cache-grikomsn.vercel.app

![Preview of flash of unstyled content for this website](/images/fouc-before.gif)

This happens because the Chakra UI stylesheets from [`<ChakraProvider />{:jsx}`](https://chakra-ui.com/guides/with-nextjs#chakra-providers) are not loaded server-side and only client-side. The solution, since Chakra UI is based on [Emotion](https://emotion.sh/), is to render the styles server-side and cache it using two additional Emotion packages, [`@emotion/cache`](https://emotion.sh/docs/@emotion/cache) and [`@emotion/server`](https://emotion.sh/docs/@emotion/server).

```sh
# using yarn
yarn add @emotion/cache @emotion/server

# using npm
npm install @emotion/cache @emotion/server
```

After adding those dependencies, first make the Emotion cache instance, preferably on a separate source file, e.g. `lib/emotion-cache.ts` ([example source file for this website](https://github.com/grikomsn/griko.id-v7/blob/main/packages/v7/lib/emotion-cache.ts)):

```typescript
import createCache from "@emotion/cache";

export default createCache({
  key: "css",
});
```

Then, render the stylesheets in `pages/_document.tsx` via `Document.getInitialProps` and use the previously made cache instance with `@emotion/server`'s `extractCritical` ([example source file for this website](https://github.com/grikomsn/griko.id-v7/blob/main/packages/v7/pages/_document.tsx)):

```tsx {9,14,19-23}
import * as React from "react";

import emotionCache from "~lib/emotion-cache";

import { ColorModeScript } from "@chakra-ui/react";
import createEmotionServer from "@emotion/server/create-instance";
import Document, { DocumentContext, Head, Html, Main, NextScript } from "next/document";

const { extractCritical } = createEmotionServer(emotionCache);

export default class CustomDocument extends Document {
  static async getInitialProps(ctx: DocumentContext) {
    const initialProps = await Document.getInitialProps(ctx);
    const styles = extractCritical(initialProps.html);
    return {
      ...initialProps,
      styles: [
        initialProps.styles,
        <style
          key="emotion-css"
          dangerouslySetInnerHTML={{ __html: styles.css }}
          data-emotion-css={styles.ids.join(" ")}
        />,
      ],
    };
  }

  render() {
    return (
      <Html lang="en">
        <Head>
          <meta charSet="UTF-8" />
          <meta content="ie=edge" httpEquiv="X-UA-Compatible" />
        </Head>

        <body>
          <ColorModeScript />
          <Main />
          <NextScript />
        </body>
      </Html>
    );
  }
}
```

With that, the page should now render the stylesheets both server-side and client-side. Here's an example of this website after adding the solution: https://v7-git-test-with-emotion-cache-grikomsn.vercel.app

![Preview of cached stylings for this website](/images/fouc-after.gif)

TL;DR, use `@emotion/cache` and `@emotion/server` to prevent initial unstyled content. Theoretically this should also work on Next.js static exports if you're using `next export`. You can [see the full project for this website on GitHub](https://github.com/grikomsn/griko.id-v7/tree/main/packages/v7).

Hope this helps! üôåüèª

---

_This is also cross-posted on [dev.to](https://dev.to/grikomsn/prevent-fouc-on-next-js-chakra-ui-2829) and [Medium](https://griko.medium.com/prevent-fouc-on-next-js-chakra-ui-68df8b1b63ab)._
